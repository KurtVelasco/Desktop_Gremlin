        //private void DeleteOneTargetFile()
        //{
        //    string desktopPath = Environment.GetFolderPath(Environment.SpecialFolder.DesktopDirectory);

        //    string filename = $"target{deleteIndex}.txt";
        //    string fullPath = Path.Combine(desktopPath, filename);

        //    if (File.Exists(fullPath))
        //    {
        //        try
        //        {
        //            FileSystem.DeleteFile(fullPath, UIOption.OnlyErrorDialogs, RecycleOption.SendToRecycleBin);
        //        }
        //        catch
        //        {
        //            // silently ignore errors
        //        }
        //    }

        //    
        //    deleteIndex++;

        //   
        //    if (deleteIndex > MAX_TARGETS) 
        //        deleteIndex = 1;
        //}
        //private DateTime lastDeleteTime = DateTime.MinValue;
        //private TimeSpan deleteInterval = TimeSpan.FromMilliseconds(300);
        //private static int MAX_TARGETS = 70;
        //private static int deleteIndex = 1;




         private void StartFollowingFood()
        {
            double _startingSpeed = Settings.CurrentItemAcceleration;
            _followTimer?.Stop();
            _followTimer = new DispatcherTimer { Interval = TimeSpan.FromMilliseconds(1000.0 / Settings.FrameRate) };
            _followTimer.Tick += (s, e) =>
            {
                if (_currentFood == null || !_currentFood.IsVisible)
                {
                    _followTimer.Stop();
                    AnimationStates.UnlockState();
                    MediaManager.PlaySound("sleep.wav");
                    AnimationStates.SetState("Sleeping");
                    AnimationStates.LockState();
                    return;
                }

                System.Windows.Point foodCenter = _currentFood.GetCenter();
                double gremlinCenterX = this.Left + this.ActualWidth / 2;
                double gremlinCenterY = this.Top + this.ActualHeight / 2;
                double dx = foodCenter.X - gremlinCenterX;
                double dy = foodCenter.Y - gremlinCenterY;
                double distance = Math.Sqrt(dx * dx + dy * dy);

                if (distance < Settings.FoodItemGetSize || !AnimationStates.GetState("FollowItem"))
                {
                    _currentFood.Close();
                    return;
                }

                _startingSpeed = Math.Min(_startingSpeed + Settings.ItemAcceleration, Settings.MaxItemAcceleration);
                double step = Math.Min(_startingSpeed, distance);

                this.Left += dx / distance * step;
                this.Top += dy / distance * step;

                double angle = Math.Atan2(dy, dx) * (180 / Math.PI);
                if (angle < 0) angle += 360;

                if (angle >= 337.5 || angle < 22.5)
                {
                    CurrentFrames.Right = SpriteManager.PlayAnimation("runRight","Run", CurrentFrames.Right, FrameCounts.Right, SpriteImage);
                }
                else if (angle >= 22.5 && angle < 67.5)
                {
                    CurrentFrames.DownRight = SpriteManager.PlayAnimation("downRight","Run", CurrentFrames.DownRight, FrameCounts.DownRight, SpriteImage);
                }
                else if (angle >= 67.5 && angle < 112.5)
                {
                    CurrentFrames.Down = SpriteManager.PlayAnimation("runDown","Run", CurrentFrames.Down, FrameCounts.Down, SpriteImage);
                }
                else if (angle >= 112.5 && angle < 157.5)
                {
                    CurrentFrames.DownLeft = SpriteManager.PlayAnimation("downLeft","Run", CurrentFrames.DownLeft, FrameCounts.DownLeft, SpriteImage);
                }
                else if (angle >= 157.5 && angle < 202.5)
                {
                    CurrentFrames.Left = SpriteManager.PlayAnimation("runLeft","Run", CurrentFrames.Left, FrameCounts.Left, SpriteImage);
                }
                else if (angle >= 202.5 && angle < 247.5)
                {
                    CurrentFrames.UpLeft = SpriteManager.PlayAnimation("upLeft","Run", CurrentFrames.UpLeft, FrameCounts.UpLeft, SpriteImage);
                }
                else if (angle >= 247.5 && angle < 292.5)
                {
                    CurrentFrames.Up = SpriteManager.PlayAnimation("runUp","Run", CurrentFrames.Up, FrameCounts.Up, SpriteImage);
                }
                else if (angle >= 292.5 && angle < 337.5)
                {
                    CurrentFrames.UpRight = SpriteManager.PlayAnimation("upRight","Run", CurrentFrames.UpRight, FrameCounts.UpRight, SpriteImage);
                }

                AnimationStates.SetState("Walking");
            };
            _followTimer.Start();
        }


         private void TopHotspot_Click(object sender, MouseButtonEventArgs e)
        {
            if (AnimationStates.GetState("FollowItem"))
            {
                return;
            }
            AnimationStates.UnlockState();
            AnimationStates.SetState("FollowItem");
            AnimationStates.LockState();
            MediaManager.PlaySound("spawn.wav");
            double screenWidth = SystemParameters.WorkArea.Width;
            double screenHeight = SystemParameters.WorkArea.Height;

            Random rng = new Random();
            double randomLeft = rng.NextDouble() * (screenWidth - Settings.ItemWidth) + SystemParameters.WorkArea.Left;
            double randomTop = rng.NextDouble() * (screenHeight - Settings.ItemHeight) + SystemParameters.WorkArea.Top;
            _currentFood = new Target
            {
                Left = randomLeft,
                Top = randomTop
            };
            _currentFood.Show();
            StartFollowingFood();
        }
             if (AnimationStates.GetState("Sleeping"))
                {
                    CurrentFrames.Sleep = SpriteManager.PlayAnimation(
                       "sleep",
                       "Actions",   
                       CurrentFrames.Sleep,
                       FrameCounts.Sleep,
                       SpriteImage);
                }
                if (AnimationStates.GetState("Pat"))
                {
                    AnimationStates.LockState();
                    CurrentFrames.Pat = SpriteManager.PlayAnimation(
                      "pat",
                      "Actions",
                      CurrentFrames.Pat,
                      FrameCounts.Pat,
                      SpriteImage);
                    if (CurrentFrames.Pat == 0) {
                        AnimationStates.UnlockState();
                        AnimationStates.ResetAllExceptIdle();
                    }
                }